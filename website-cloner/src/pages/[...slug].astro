---
import Layout from "../components/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getAllRoutes, getPageByPath } from "../utils/data-loader";

export async function getStaticPaths() {
  const routes = await getAllRoutes();
  
  return routes.map(route => ({
    params: { 
      slug: route.path.split('/').filter(Boolean) 
    },
    props: {
      route
    }
  }));
}

interface Props {
  route: {
    url: string;
    path: string;
    title: string;
  };
}

const { route } = Astro.props;
const pageData = await getPageByPath(route.path);
---

<Layout title={route.title}>
  <Header />
  
  <main class="page-content">
    {pageData ? (
      <Fragment set:html={pageData.renderedHTML} />
    ) : (
      <div class="not-found">
        <h1>Page not found</h1>
        <p>The page at {route.path} could not be loaded.</p>
      </div>
    )}
  </main>
  
  <Footer />
</Layout>

<style>
  .page-content {
    min-height: calc(100vh - 200px);
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .not-found {
    text-align: center;
    padding: 4rem 2rem;
  }
  
  .not-found h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }
</style>
